#cloud-config
autoinstall:
  version: 1
  
  ssh:
    install-server: true
    allow-pw: false

  storage:
    version: 1
    grub:
      reorder_uefi: false
    swap:
      size: 0
    config:
      - id: disk0
        type: disk
        ptable: gpt
        path: /dev/sda
        preserve: false
        wipe: superblock-recursive
        grub_device: true
      - id: disk0-part0
        type: partition
        size: 1MB
        device: disk0
        flag: bios_grub
      - id: disk0-part1
        type: partition
        size: 5GB
        device: disk0
        flag: boot
      - id: disk0-part2
        type: partition
        size: 30GB
        device: disk0
      - id: vg0
        type: lvm_volgroup
        name: root-lvm
        devices:
          - disk0-part2
      - id: lvm-part0
        type: lvm_partition
        name: root-partition
        size: 100%
        volgroup: vg0
      - id: lvm-part0-fs
        type: format
        fstype: ext4
        label: root
        volume: lvm-part0
      - id: lvm-part0-fs-mount0
        path: /
        type: mount
        device: lvm-part0-fs

  packages:
    - ansible
    - git
    - jq

  user-data:
    disable_root: true
    package_update: true
    package_upgrade: true
    users:
      - name: ansible
        gecos: Ansible User
        groups: users,admin,wheel
        sudo: ALL=(ALL) NOPASSWD:ALL
        shell: /bin/bash
        lock_passwd: true
        ssh_authorized_keys:
          - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOoS2B6npMiBYWNl/pYoI14FDWSd2DoT0M49l14k1XLK anthonyra@Anthonys-Mac-Studio.local
